{"ast":null,"code":"var _jsxFileName = \"/Users/jennifervphan/Desktop/final project/grandmeet-client/src/pages/Nearby.jsx\";\nimport React, { Component } from 'react';\nimport { geolocated } from 'react-geolocated';\nimport axios from 'axios';\nimport MainLayout from '../components/layout/MainLayout';\nimport { Link } from 'react-router-dom';\nimport './Nearby.css';\n\nclass Nearby extends Component {\n  constructor(props) {\n    super(props);\n    this._isMounted = false;\n\n    this.calculateUserDist = users => {\n      let userLong = this.props.userInSession.longitude;\n      let userLat = this.props.userInSession.latitude;\n\n      for (var i = 0; i < users.length; i++) {\n        let otherLong = users[i].longitude;\n        let otherLat = users[i].latitude;\n        users[i][\"distance\"] = this.calculateDistance(userLat, userLong, otherLat, otherLong);\n      }\n\n      users.sort(function (a, b) {\n        return a.distance - b.distance;\n      });\n      return users;\n    };\n\n    this.state = {\n      users: [],\n      sortedUsers: []\n    };\n    this.calculateDistance = this.calculateDistance.bind(this);\n  }\n\n  calculateDistance(lat1, lon1, lat2, lon2) {\n    lat1 = Math.PI * lat1 / 180;\n    lat2 = Math.PI * lat2 / 180;\n    lon1 = Math.PI * lon1 / 180;\n    lon2 = Math.PI * lon2 / 180;\n    var R = 6371; // km\n\n    var x = (lon2 - lon1) * Math.cos((lat1 + lat2) / 2);\n    var y = lat2 - lat1;\n    var d = Math.floor(Math.sqrt(x * x + y * y) * R);\n    return d;\n  }\n\n  componentDidMount() {\n    // this._isMounted = true;\n    axios.get(\"\".concat(process.env.REACT_APP_API, \"/nearby\"), {\n      withCredentials: true\n    }).then(responseFromApi => {\n      // if (this._isMounted) {\n      let users = this.calculateUserDist(responseFromApi.data);\n      localStorage.setItem('nearbyUsers', JSON.stringify(users));\n      setTimeout(() => {\n        this.setState({\n          sortedUsers: users\n        });\n      }, 500); // }\n    });\n  } // componentWillUnmount() {\n  //     this._isMounted = false;\n  //   }\n\n\n  render() {\n    if (this.state.sortedUsers.length > 0) {\n      const users = this.state.sortedUsers;\n      let eachUser = users.map(user => {\n        return React.createElement(Link, {\n          style: {\n            textDecoration: \"none\"\n          },\n          to: {\n            pathname: \"/nearby/\".concat(user._id)\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"avaPic eachUser\",\n          style: {\n            backgroundImage: \"url(\".concat(user.profilePicUrl, \")\")\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 70\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"nameDist\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 71\n          },\n          __self: this\n        }, React.createElement(\"h3\", {\n          style: {\n            margin: \"0\",\n            color: \"black\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 72\n          },\n          __self: this\n        }, user.username), React.createElement(\"p\", {\n          style: {\n            fontSize: \"20px\",\n            margin: \"0\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 73\n          },\n          __self: this\n        }, React.createElement(\"i\", {\n          className: \"fas fa-map-marker-alt\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 73\n          },\n          __self: this\n        }), \" \", user.distance, \"km\"))));\n      });\n      return React.createElement(MainLayout, Object.assign({}, this.props, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"NearbyPage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }, eachUser));\n    }\n\n    return React.createElement(MainLayout, Object.assign({}, this.props, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }), React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, \"Loading...\"));\n  }\n\n}\n\nexport default geolocated({\n  positionOptions: {\n    enableHighAccuracy: false\n  },\n  userDecisionTimeout: 5000\n})(Nearby);","map":{"version":3,"sources":["/Users/jennifervphan/Desktop/final project/grandmeet-client/src/pages/Nearby.jsx"],"names":["React","Component","geolocated","axios","MainLayout","Link","Nearby","constructor","props","_isMounted","calculateUserDist","users","userLong","userInSession","longitude","userLat","latitude","i","length","otherLong","otherLat","calculateDistance","sort","a","b","distance","state","sortedUsers","bind","lat1","lon1","lat2","lon2","Math","PI","R","x","cos","y","d","floor","sqrt","componentDidMount","get","process","env","REACT_APP_API","withCredentials","then","responseFromApi","data","localStorage","setItem","JSON","stringify","setTimeout","setState","render","eachUser","map","user","textDecoration","pathname","_id","backgroundImage","profilePicUrl","margin","color","username","fontSize","positionOptions","enableHighAccuracy","userDecisionTimeout"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {geolocated} from 'react-geolocated';\nimport axios from 'axios';\nimport MainLayout from '../components/layout/MainLayout';\nimport {Link} from 'react-router-dom';\nimport './Nearby.css';\n\nclass Nearby extends Component {\n    _isMounted = false\n\n    constructor(props){\n        super(props);\n        this.state={\n            users:[],\n            sortedUsers:[]\n        }\n        this.calculateDistance=this.calculateDistance.bind(this);\n    }\n\n    calculateDistance (lat1, lon1, lat2, lon2){\n        lat1 =  Math.PI * lat1/180\n        lat2 = Math.PI * lat2/180\n        lon1 = Math.PI * lon1/180\n        lon2 = Math.PI * lon2/180\n        var R = 6371; // km\n        var x = (lon2 - lon1) * Math.cos((lat1 + lat2) / 2);\n        var y = (lat2 - lat1);\n        var d = Math.floor(Math.sqrt(x * x + y * y) * R);\n        return d;\n      }\n\n    componentDidMount() {\n        // this._isMounted = true;\n        axios.get(`${process.env.REACT_APP_API}/nearby`, {withCredentials:true})\n        .then(responseFromApi => {\n            // if (this._isMounted) {\n                let users= this.calculateUserDist(responseFromApi.data);\n                localStorage.setItem('nearbyUsers', JSON.stringify(users));\n                setTimeout(()=>{\n                     this.setState({sortedUsers:users});\n                }, 500)\n        // }\n    })\n    }\n\n    // componentWillUnmount() {\n    //     this._isMounted = false;\n    //   }\n\n      calculateUserDist= (users)=> {\n        let userLong= this.props.userInSession.longitude;\n        let userLat= this.props.userInSession.latitude;\n        for (var i = 0; i < users.length; i++) {\n            let otherLong=users[i].longitude;\n            let otherLat= users[i].latitude;\n            users[i][\"distance\"] = this.calculateDistance(userLat,userLong,otherLat,otherLong);}\n        users.sort(function(a, b) { \n            return a.distance - b.distance;\n        });\n        return users\n    } \n\n    render() {\n        if(this.state.sortedUsers.length>0){        \n        const users = this.state.sortedUsers;\n        let eachUser=users.map(user=>{\n            return(\n                    <Link style={{textDecoration:\"none\"}} to={{ pathname: `/nearby/${user._id}`}}>\n\n                        <div className=\"avaPic eachUser\" style={{backgroundImage:`url(${user.profilePicUrl})` }}>\n                        <div className=\"nameDist\">\n                            <h3 style={{margin:\"0\",color:\"black\"}}>{user.username}</h3>\n                            <p style={{fontSize:\"20px\", margin:\"0\"}}><i className=\"fas fa-map-marker-alt\"></i> {user.distance}km</p>\n                        </div>\n                        </div>\n                    </Link>\n            )\n        })\n        return (\n            <MainLayout {...this.props}>\n            <div className=\"NearbyPage\">\n              {eachUser}  \n            </div>\n            </MainLayout>\n        )}\n        return(\n            <MainLayout {...this.props}>\n                <h1>Loading...</h1>\n            </MainLayout>\n        )\n    }\n}\n\nexport default geolocated({\n    positionOptions: {\n      enableHighAccuracy: false,\n    },\n    userDecisionTimeout: 5000,\n  })(Nearby);"]},"metadata":{},"sourceType":"module"}